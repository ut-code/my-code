---
id: python-file-io-4-with
title: with文による安全なファイル操作（コンテキストマネージャ）
level: 2
---

## `with`文による安全なファイル操作（コンテキストマネージャ）

ファイルを `open()` したら `close()` する必要がありますが、処理中に例外が発生すると `close()` が呼ばれない可能性があります。これを確実に、そして簡潔に書く方法が **`with`** 文です。

**`with`** 文のブロックを抜けると、ファイルオブジェクトは自動的に `close()` されます。エラーが発生した場合でも同様です。これは「コンテキストマネージャ」という仕組みによって実現されており、ファイル操作の標準的な方法です。

```python-repl:4
>>> # with文を使った書き込み
>>> with open('spam.txt', 'w', encoding='utf-8') as f:
...     f.write('withブロックを使っています。\n')
...     f.write('ブロックを抜けると自動で閉じられます。\n')
... 
>>> # ブロックの外ではファイルは閉じている
>>> f.closed
True

>>> # with文を使った読み込み
>>> with open('spam.txt', 'r', encoding='utf-8') as f:
...     data = f.read()
... 
>>> print(data)
withブロックを使っています。
ブロックを抜けると自動で閉じられます。

```

このように、`with` 文を使えば `close()` の呼び出しを忘れる心配がなく、コードもすっきりします。今後は常に `with` 文を使ってファイルを扱うようにしましょう。

```text-readonly:spam.txt
withブロックを使っています。
ブロックを抜けると自動で閉じられます。
```
