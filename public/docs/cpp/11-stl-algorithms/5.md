---
id: cpp-stl-algorithms-5
title: ラムダ式：その場で書ける無名関数
level: 2
---

## ラムダ式：その場で書ける無名関数

ラムダ式（Lambda Expression）は、C++11から導入された非常に強力な機能です。一言で言えば、「**その場で定義して使える名前のない小さな関数**」です。これにより、アルゴリズムに渡すためだけの短い関数をわざわざ定義する必要がなくなり、コードが非常に簡潔になります。

ラムダ式の基本的な構文は以下の通りです。

```cpp
[キャプチャ](引数リスト) -> 戻り値の型 { 処理本体 }
```

  * `[]` **キャプチャ句**: ラムダ式の外にある変数を取り込んで、式の中で使えるようにします。
      * `[]`: 何もキャプチャしない。
      * `[=]`: 外の変数を全て値渡し（コピー）でキャプチャする。
      * `[&]`: 外の変数を全て参照渡しでキャプチャする。
      * `[x, &y]`: 変数 `x` は値渡し、変数 `y` は参照渡しでキャプチャする。
  * `()` **引数リスト**:通常の関数と同じ引数を取ることができます。
  * `-> 戻り値の型`: 戻り値の型を指定します。多くの場合、コンパイラが推論できるため省略可能です。
  * `{}` **処理本体**: 関数の処理内容を記述します。

`std::for_each` とラムダ式を組み合わせた例を見てみましょう。

```cpp:for_each_lambda_example.cpp
#include <iostream>
#include <vector>
#include <algorithm>

int main() {
    std::vector<int> numbers = {1, 2, 3, 4, 5};

    // 各要素を2倍して表示する
    std::cout << "Doubled numbers: ";
    std::for_each(numbers.begin(), numbers.end(), [](int n) {
        std::cout << n * 2 << " ";
    });
    std::cout << std::endl;

    // 外部の変数をキャプチャする例
    int sum = 0;
    // `&sum` で sum を参照キャプチャし、ラムダ式内で変更できるようにする
    std::for_each(numbers.begin(), numbers.end(), [&sum](int n) {
        sum += n;
    });

    std::cout << "Sum: " << sum << std::endl;

    return 0;
}
```

```cpp-exec:for_each_lambda_example.cpp
Doubled numbers: 2 4 6 8 10 
Sum: 15
```

このコードは、`for_each` の3番目の引数に直接処理を書き込んでいます。非常に直感的で読みやすいと思いませんか？

ラムダ式は、特に `std::sort` のソート順をカスタマイズする際に真価を発揮します。例えば、数値を降順にソートしたい場合、比較ルールをラムダ式で与えることができます。

```cpp:lambda_sort_example.cpp
#include <iostream>
#include <vector>
#include <algorithm>

int main() {
    std::vector<int> numbers = {5, 2, 8, 1, 9};

    // 比較関数としてラムダ式を渡す
    // a > b であれば true を返すことで降順ソートになる
    std::sort(numbers.begin(), numbers.end(), [](int a, int b) {
        return a > b;
    });

    std::cout << "Sorted in descending order: ";
    for (int num : numbers) {
        std::cout << num << " ";
    }
    std::cout << std::endl;

    return 0;
}
```

```cpp-exec:lambda_sort_example.cpp
Sorted in descending order: 9 8 5 2 1 
```
