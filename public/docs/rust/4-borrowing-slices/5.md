---
id: rust-borrowing-slices-5
title: 不変参照と可変参照の共存禁止
level: 3
---

### 不変参照と可変参照の共存禁止

同様に、「誰かがデータを読んでいる最中（不変参照）に、誰かがデータを書き換える（可変参照）」ことも禁止されています。読んでいる最中にデータが変わると困るからです。

以下のコードはコンパイルエラーになります（概念を示すための例です）。

```rust
let mut s = String::from("hello");

let r1 = &s; // 問題なし
let r2 = &s; // 問題なし
let r3 = &mut s; // 大問題！不変参照が存在している間に可変参照は作れない

println!("{}, {}, and {}", r1, r2, r3);
```

しかし、**スコープ**を利用すれば、この制限をクリアできます。直前の参照が使用されなくなった（スコープを抜けた）後であれば、新しい参照を作ることができます。

```rust:borrow_scope.rs
fn main() {
    let mut s = String::from("hello");

    {
        let r1 = &mut s;
        r1.push_str(" world");
        // r1 はここでスコープを抜ける
    } 

    // r1 はもういないので、新しい不変参照を作れる
    let r2 = &s;
    println!("Final string: {}", r2);
}
```

```rust-exec:borrow_scope.rs
Final string: hello world
```
