---
id: rust-borrowing-slices-6
title: 5.3 ダングリングポインタの防止
level: 2
---

## 5.3 ダングリングポインタの防止

C++などの言語では、メモリが解放された後の場所を指し続けるポインタ（ダングリングポインタ）を作ってしまうことがあり、これが重大なバグの原因になります。
Rustでは、**コンパイラがこれを絶対に許可しません**。

以下のコードは、「関数内で作成した変数の参照」を返そうとしていますが、これはエラーになります。

```rust
// コンパイルエラーになる例
fn dangle() -> &String {
    let s = String::from("hello");
    &s // sの参照を返す
} // ここでsはスコープを抜け、メモリが解放される。参照先が消滅する！
```

Rustコンパイラは「データのライフタイム（生存期間）が、その参照よりも短い」と判断し、エラーを出してくれます。この場合は、参照ではなく値を返して所有権を移動させるのが正解です。
