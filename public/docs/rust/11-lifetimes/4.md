---
id: rust-lifetimes-4
title: ライフタイム省略ルール
level: 2
---

## ライフタイム省略ルール

「待ってください。第4章で書いた `fn first_word(s: &str) -> &str` は注釈なしで動きましたよ？」

鋭い質問です。初期のRustではすべての参照に明示的なライフタイムが必要でした。しかし、あまりにも頻出するパターン（例えば「引数が1つなら、戻り値のライフタイムもそれと同じ」など）があったため、Rustチームはそれらを自動推論する**「ライフタイム省略ルール（Lifetime Elision Rules）」**をコンパイラに組み込みました。

コンパイラは以下の3つのルールを順番に適用します。それでもライフタイムが決まらない場合のみ、エラーを出して人間に注釈を求めます。

1.  **各引数に独自のライフタイムを割り当てる**
      * `fn foo(x: &str, y: &str)` → `fn foo<'a, 'b>(x: &'a str, y: &'b str)`
2.  **入力ライフタイムが1つだけなら、そのライフタイムをすべての出力（戻り値）に割り当てる**
      * `fn foo<'a>(x: &'a str) -> &'a str`
      * これが `first_word` 関数で注釈が不要だった理由です。
3.  **メソッド（`&self` または `&mut self` を含む）の場合、`self` のライフタイムをすべての出力に割り当てる**
      * これにより、構造体のメソッドを書く際にいちいち注釈を書かずに済みます。
