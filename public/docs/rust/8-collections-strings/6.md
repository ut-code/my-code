---
id: rust-collections-strings-6
title: なぜインデックスアクセスができないのか？
level: 3
---

### なぜインデックスアクセスができないのか？

多くの言語では `s[0]` で1文字目を取得できますが、Rustでは**コンパイルエラー**になります。

Rustの文字列はUTF-8です。ASCII文字は1バイトですが、日本語のような文字は3バイト（またはそれ以上）を使用します。

  * `"A"` -\> `[0x41]` (1バイト)
  * `"あ"` -\> `[0xE3, 0x81, 0x82]` (3バイト)

もし `"あ"` という文字列に対して `s[0]` で1バイト目を取得できたとしても、それは `0xE3` という意味のないバイト値であり、プログラマが期待する「あ」ではありません。Rustはこの誤解を防ぐために、インデックスアクセスを禁止しています。

文字列の中身を見るには、「バイトとして見る」か「文字（スカラ値）として見る」かを明示する必要があります。

```rust:string_utf8.rs
fn main() {
    let s = "こんにちは"; // UTF-8で各文字3バイト

    // NG: s[0] はコンパイルエラー

    // 文字（char）として反復処理
    // RustのcharはUnicodeスカラ値（4バイト）
    print!("Chars: ");
    for c in s.chars() {
        print!("{} ", c);
    }
    println!();

    // バイトとして反復処理
    print!("Bytes: ");
    for b in s.bytes() {
        print!("{:x} ", b); // 16進数で表示
    }
    println!();
    
    // 部分文字列（スライス）の取得には範囲指定が必要
    // ただし、文字の境界に合わないバイトを指定すると実行時にパニックする
    let s_slice = &s[0..3]; // 最初の3バイト＝「こ」
    println!("Slice: {}", s_slice);
}
```

```rust-exec:string_utf8.rs
Chars: こ ん に ち は 
Bytes: e3 81 93 e3 82 93 e3 81 ab e3 81 a1 e3 81 8a 
Slice: こ
```
