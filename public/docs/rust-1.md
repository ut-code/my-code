# 第1章: Rustの世界へようこそ

Rustは、Mozillaによって開始され、現在はRust Foundationによって管理されているオープンソースのシステムプログラミング言語です。Stack OverflowのDeveloper Surveyで長年「最も愛されている言語」に選ばれ続けているのには理由があります。

## Rustの特徴：なぜ学ぶのか？

経験豊富なプログラマにとって、Rustは「トレードオフを解消する」言語として映るはずです。

### 1\. メモリ安全性（Memory Safety）

C/C++ではプログラマの責任であったメモリ管理を、Rustは**所有権（Ownership）**というコンパイル時のシステムで保証します。

  * ガベージコレクタ（GC）は**存在しません**。
  * ランタイムコストなしに、ダングリングポインタや二重解放、バッファオーバーフローをコンパイル段階で防ぎます。

### 2\. ゼロコスト抽象化（Zero-cost Abstractions）

「使わないものにはコストを払わない。使うものについては、手書きのコード以上のコストをかけない」というC++の哲学を継承しています。イテレータや高階関数を使っても、最適化された低レベルコードと同等のパフォーマンスが得られます。

### 3\. 安全な並行性（Fearless Concurrency）

多くの言語で並行処理はバグの温床（データ競合など）ですが、Rustではコンパイラがデータ競合を検知し、コンパイルエラーとして報告します。「コンパイルが通れば、並行性のバグを含んでいる可能性は低い」という安心感を持ってコーディングできます。

## 開発環境の構築

Rustの開発環境は非常にモダンで、バージョン管理やパッケージ管理が統合されています。

### `rustup` のインストール

Rustのバージョンマネージャである `rustup` を使用してインストールするのが標準的です。

macOS / Linux / WSL (Windows Subsystem for Linux) の場合：

```bash
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
```

Windowsの場合：
公式サイト（rust-lang.org）から `rustup-init.exe` をダウンロードして実行します（C++ビルドツールが必要になる場合があります）。

インストール後、以下のコマンドでバージョンが表示されれば成功です。

```bash
rustc --version
cargo --version
```

## Hello World (`rustc` を直接使う)

まずは、ビルドシステムを使わずにコンパイラ `rustc` を直接叩いて、Rustプログラムの最小単位を見てみましょう。

以下のコードを記述します。

```rust:hello.rs
fn main() {
    // !がついているのは関数ではなく「マクロ」の呼び出しです
    println!("Hello, world from rustc!");
}
```

コンパイルと実行は以下の手順で行います。

1.  コンパイル: `rustc hello.rs`
      * これにより、バイナリファイル（Windowsなら`.exe`）が生成されます。
2.  実行: `./hello` (Windowsなら `.\hello.exe`)

<!-- end list -->

```rust-exec:hello.rs
Hello, world from rustc!
```

### ポイント

  * **`fn main() { ... }`**: エントリポイントです。引数や戻り値がない場合、このように記述します。
  * **`println!`**: 末尾に `!` がついているのは**マクロ**であることを示しています。Rustでは可変長引数を取る機能などをマクロとして実装しています。
  * **セミコロン `;`**: 文の終わりには必須です。

## Cargo：Rustのビルドシステムとパッケージマネージャ

実際の開発では `rustc` を直接使うことは稀です。公式のビルドシステム兼パッケージマネージャである **Cargo** を使用します。Node.jsにおける `npm`、Pythonにおける `pip` + `venv` のような存在ですが、それ以上にプロジェクトのライフサイクル全体を管理します。

### プロジェクトの作成 (`cargo new`)

新しいプロジェクトを作成します。

```bash
cargo new hello_cargo
cd hello_cargo
```

このコマンドにより、以下のディレクトリ構造が生成されます。

  * **`Cargo.toml`**: パッケージのマニフェストファイル（依存関係やメタデータを記述）。
  * **`src/main.rs`**: ソースコード。
  * **`.gitignore`**: Gitの設定ファイルも自動生成されます。

### Cargoの主要コマンド

生成されたプロジェクトで、以下のコマンドを試してみましょう。

1.  **`cargo check`**

      * **重要**: コンパイルが可能かどうかのチェックだけを行い、実行ファイルは生成しません。高速に動作するため、コーディング中の構文チェックとして頻繁に使用します。

2.  **`cargo build`**

      * デバッグビルドを行います。成果物は `target/debug/` に生成されます。コンパイル速度重視で、最適化は行われません。

3.  **`cargo run`**

      * ビルドと実行を一度に行います。開発中はこれが最も使われます。

4.  **`cargo build --release`**

      * リリースビルドを行います。`target/release/` に生成されます。コンパイル時間は長くなりますが、強力な最適化がかかり、実行速度が劇的に向上します。

`src/main.rs` の中身は以下のようになっています（生成時デフォルト）。

```rust
fn main() {
    println!("Hello, world!");
}
```

## フォーマッタとリンタ

Rustは「公式のスタイル」を重視する言語です。議論の余地をなくすために強力なツールが標準で用意されています。

### `rustfmt` (コードフォーマッタ)

Go言語の `gofmt` のように、コードを自動整形します。

```bash
cargo fmt
```

多くのエディタ（VS Codeなど）では保存時に自動実行されるよう設定するのが一般的です。

### `clippy` (リンタ)

単なるスタイルチェックだけでなく、パフォーマンスの改善案や、Rustらしい書き方（Idiomatic Rust）を提案してくれます。

```bash
cargo clippy
```

例えば、無駄な計算や非推奨なAPIの使用などを指摘してくれるため、学習中はこのコマンドの警告に従うだけでRustの理解が深まります。
