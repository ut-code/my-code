---
id: ruby-proc-lambda-7
title: クロージャ（スコープ）の概念
level: 2
---

## クロージャ（スコープ）の概念

`Proc` オブジェクト（`lambda` も含む）の非常に重要な特性として、**クロージャ (Closure)** があります。

クロージャとは、**Proc オブジェクトが、それが定義された時点のスコープ（環境）を記憶し、後で実行される際にもそのスコープ内の変数（ローカル変数など）にアクセスできる**仕組みです。

JavaScriptなど、他の言語でクロージャに触れたことがあるかもしれません。Rubyの `Proc` も同様の機能を提供します。

```ruby:closure_example.rb
def counter_generator(initial_value)
  count = initial_value
  
  # この lambda は、外側のスコープにある `count` 変数を記憶する
  incrementer = lambda do
    puts "Current count: #{count}"
    count += 1 # 記憶した変数を更新
    puts "New count: #{count}"
  end
  
  return incrementer # Proc オブジェクトを返す
end

# counter_generator メソッドの実行は終了し、
# 本来ローカル変数 `count` は消えるはず...
counter1 = counter_generator(10)

puts "--- First call ---"
counter1.call # => Current count: 10, New count: 11

puts "--- Second call ---"
counter1.call # => Current count: 11, New count: 12

# 別のスコープを持つカウンターを作成
counter2 = counter_generator(100)
puts "--- Counter 2 call ---"
counter2.call # => Current count: 100, New count: 101

puts "--- Counter 1 call again ---"
counter1.call # => Current count: 12, New count: 13
```

```ruby-exec:closure_example.rb
--- First call ---
Current count: 10
New count: 11
--- Second call ---
Current count: 11
New count: 12
--- Counter 2 call ---
Current count: 100
New count: 101
--- Counter 1 call again ---
Current count: 12
New count: 13
```

`counter_generator` メソッドが終了した後でも、返された `lambda` オブジェクト（`counter1` や `counter2`）は、それぞれが定義された時点の `count` 変数を保持し続け、`call` されるたびにそれを更新できます。これがクロージャの力です。
