---
id: javascript-promise-1
title: イベントループとコールバックキューの仕組み
level: 2
---

## イベントループとコールバックキューの仕組み

なぜシングルスレッドで非同期処理が可能なのか、その裏側にあるのが **イベントループ (Event Loop)** という仕組みです。

JavaScriptのランタイムは主に以下の要素で構成されています：

1.  **コールスタック (Call Stack):** 現在実行中の関数が積まれる場所。LIFO（後入れ先出し）。
2.  **Web APIs / Node APIs:** ブラウザやOSが提供する機能（タイマー、Fetch、DOMイベントなど）。非同期処理はここで実行されます。
3.  **コールバックキュー (Callback Queue):** 非同期処理が完了した後、実行待ちのコールバック関数が並ぶ列。
4.  **イベントループ (Event Loop):** コールスタックとキューを監視する仕組み。

**処理の流れ:**

1.  `setTimeout` がコールスタックで実行されると、ブラウザのタイマーAPIに処理を依頼し、スタックから消えます。
2.  指定時間が経過すると、タイマーAPIはコールバック関数を **コールバックキュー** に入れます。
3.  **イベントループ** は、「コールスタックが空（メインの処理が完了）」かつ「キューにタスクがある」場合、キューからタスクを取り出してコールスタックへ移動させます。

この仕組みにより、メインスレッドをブロックすることなく非同期処理を実現しています。
